<div class="flex flex-col h-screen bg-gray-100">
  <app-header
    [title]="'Generador de Presupuestos'"
    [user]="currentUser"
    [showBackButton]="true"
  >
  </app-header>

  <!-- Contenido Principal -->
  <main class="flex-grow p-4 sm:p-6 lg:p-8 flex gap-8 min-h-0">
    <!-- Columna Izquierda: Lista de Items del Presupuesto -->
    <div class="w-2/3 flex flex-col">
      <!-- Contenedor de la tabla con scroll -->
      <div
        class="flex-grow bg-white shadow-md rounded-lg overflow-y-auto min-h-0"
      >
        <table class="min-w-full">
          <thead class="bg-gray-50 sticky top-0 z-10">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-1/2"
              >
                Descripción
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider"
              >
                Cantidad
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider"
              >
                P. Unitario
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider"
              >
                Subtotal
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider"
              ></th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <tr *ngFor="let item of budgetItems" class="hover:bg-gray-50">
              <td
                class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"
              >
                {{ item.articulo.descripcion }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ item.cantidad }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                {{ item.precioUnitario | currency : "$" }}
              </td>
              <td
                class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-800"
              >
                {{ item.subtotal | currency : "$" }}
              </td>
              <td
                class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"
              >
                <button
                  (click)="removeItem(item)"
                  class="text-red-600 hover:text-red-900"
                >
                  Quitar
                </button>
              </td>
            </tr>
            <tr *ngIf="budgetItems.length === 0">
              <td colspan="5" class="text-center py-10 text-gray-500">
                Aún no hay artículos en el presupuesto.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Columna Derecha: Acciones y Totales -->
    <div class="w-1/3 flex flex-col">
      <div class="bg-white shadow-md rounded-lg p-6 flex flex-col flex-grow">
        <div>
          <h2 class="text-xl font-bold text-gray-800">Acciones</h2>
          <button
            (click)="openAddArticleModal()"
            class="mt-4 w-full flex items-center justify-center gap-2 px-4 py-2 text-white font-semibold bg-blue-600 rounded-md hover:bg-blue-700"
          >
            <svg
              xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)"
              viewBox="0 0 20 20"
              fill="currentColor"
              class="w-5 h-5"
            >
              <path
                d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"
              />
            </svg>
            Añadir Artículo (F2)
          </button>
        </div>

        <div class="border-t pt-6 space-y-4">
          <h2 class="text-xl font-bold text-gray-800">Resumen</h2>
          <div class="flex justify-between text-lg">
            <span class="text-gray-600">Subtotal:</span>
            <span class="font-semibold text-gray-900">{{
              total | currency : "$"
            }}</span>
          </div>
          <div
            class="flex justify-between text-2xl font-bold border-t pt-4 mt-4"
          >
            <span class="text-gray-800">TOTAL:</span>
            <span class="text-blue-600">{{ total | currency : "$" }}</span>
          </div>
        </div>
        <div class="flex-grow"></div>
        <button
          class="w-full mt-4 px-4 py-3 text-white font-bold bg-green-600 rounded-md hover:bg-green-700"
        >
          Finalizar y Generar PDF
        </button>
      </div>
    </div>
  </main>

  <app-shortcuts-footer [shortcuts]="viewShortcuts"></app-shortcuts-footer>

  <app-search-article-modal
    *ngIf="isSearchModalOpen"
    (itemAdded)="addArticle($event)"
    (closeModal)="closeAddArticleModal()"
  >
  </app-search-article-modal>
</div>
